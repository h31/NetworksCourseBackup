\documentclass[12pt,a4paper]{report}
\usepackage[utf8]{inputenc}
\usepackage[russian]{babel}
\usepackage[OT1]{fontenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{cmap}					% поиск в PDF
\usepackage{mathtext} 				% русские буквы в формулах
%\usepackage{tikz-uml}               % uml диаграммы

% TODOs
\usepackage[%
  colorinlistoftodos,
  shadow
]{todonotes}

% Генератор текста
\usepackage{blindtext}

%------------------------------------------------------------------------------

% Подсветка синтаксиса
\usepackage{color}
\usepackage{xcolor}
\usepackage{listings}
 
 % Цвета для кода
\definecolor{string}{HTML}{B40000} % цвет строк в коде
\definecolor{comment}{HTML}{008000} % цвет комментариев в коде
\definecolor{keyword}{HTML}{1A00FF} % цвет ключевых слов в коде
\definecolor{morecomment}{HTML}{8000FF} % цвет include и других элементов в коде
\definecolor{captiontext}{HTML}{FFFFFF} % цвет текста заголовка в коде
\definecolor{captionbk}{HTML}{999999} % цвет фона заголовка в коде
\definecolor{bk}{HTML}{FFFFFF} % цвет фона в коде
\definecolor{frame}{HTML}{999999} % цвет рамки в коде
\definecolor{brackets}{HTML}{B40000} % цвет скобок в коде
 
 % Настройки отображения кода
\lstset{
language=C, % Язык кода по умолчанию
morekeywords={*,...}, % если хотите добавить ключевые слова, то добавляйте
 % Цвета
keywordstyle=\color{keyword}\ttfamily\bfseries,
stringstyle=\color{string}\ttfamily,
commentstyle=\color{comment}\ttfamily\itshape,
morecomment=[l][\color{morecomment}]{\#}, 
 % Настройки отображения     
breaklines=true, % Перенос длинных строк
basicstyle=\ttfamily\footnotesize, % Шрифт для отображения кода
backgroundcolor=\color{bk}, % Цвет фона кода
%frame=lrb,xleftmargin=\fboxsep,xrightmargin=-\fboxsep, % Рамка, подогнанная к заголовку
frame=tblr
rulecolor=\color{frame}, % Цвет рамки
tabsize=3, % Размер табуляции в пробелах
 % Настройка отображения номеров строк. Если не нужно, то удалите весь блок
numbers=left, % Слева отображаются номера строк
stepnumber=1, % Каждую строку нумеровать
numbersep=5pt, % Отступ от кода 
numberstyle=\small\color{black}, % Стиль написания номеров строк
 % Для отображения русского языка
extendedchars=true,
literate={Ö}{{\"O}}1
  {Ä}{{\"A}}1
  {Ü}{{\"U}}1
  {ß}{{\ss}}1
  {ü}{{\"u}}1
  {ä}{{\"a}}1
  {ö}{{\"o}}1
  {~}{{\textasciitilde}}1
  {а}{{\selectfont\char224}}1
  {б}{{\selectfont\char225}}1
  {в}{{\selectfont\char226}}1
  {г}{{\selectfont\char227}}1
  {д}{{\selectfont\char228}}1
  {е}{{\selectfont\char229}}1
  {ё}{{\"e}}1
  {ж}{{\selectfont\char230}}1
  {з}{{\selectfont\char231}}1
  {и}{{\selectfont\char232}}1
  {й}{{\selectfont\char233}}1
  {к}{{\selectfont\char234}}1
  {л}{{\selectfont\char235}}1
  {м}{{\selectfont\char236}}1
  {н}{{\selectfont\char237}}1
  {о}{{\selectfont\char238}}1
  {п}{{\selectfont\char239}}1
  {р}{{\selectfont\char240}}1
  {с}{{\selectfont\char241}}1
  {т}{{\selectfont\char242}}1
  {у}{{\selectfont\char243}}1
  {ф}{{\selectfont\char244}}1
  {х}{{\selectfont\char245}}1
  {ц}{{\selectfont\char246}}1
  {ч}{{\selectfont\char247}}1
  {ш}{{\selectfont\char248}}1
  {щ}{{\selectfont\char249}}1
  {ъ}{{\selectfont\char250}}1
  {ы}{{\selectfont\char251}}1
  {ь}{{\selectfont\char252}}1
  {э}{{\selectfont\char253}}1
  {ю}{{\selectfont\char254}}1
  {я}{{\selectfont\char255}}1
  {А}{{\selectfont\char192}}1
  {Б}{{\selectfont\char193}}1
  {В}{{\selectfont\char194}}1
  {Г}{{\selectfont\char195}}1
  {Д}{{\selectfont\char196}}1
  {Е}{{\selectfont\char197}}1
  {Ё}{{\"E}}1
  {Ж}{{\selectfont\char198}}1
  {З}{{\selectfont\char199}}1
  {И}{{\selectfont\char200}}1
  {Й}{{\selectfont\char201}}1
  {К}{{\selectfont\char202}}1
  {Л}{{\selectfont\char203}}1
  {М}{{\selectfont\char204}}1
  {Н}{{\selectfont\char205}}1
  {О}{{\selectfont\char206}}1
  {П}{{\selectfont\char207}}1
  {Р}{{\selectfont\char208}}1
  {С}{{\selectfont\char209}}1
  {Т}{{\selectfont\char210}}1
  {У}{{\selectfont\char211}}1
  {Ф}{{\selectfont\char212}}1
  {Х}{{\selectfont\char213}}1
  {Ц}{{\selectfont\char214}}1
  {Ч}{{\selectfont\char215}}1
  {Ш}{{\selectfont\char216}}1
  {Щ}{{\selectfont\char217}}1
  {Ъ}{{\selectfont\char218}}1
  {Ы}{{\selectfont\char219}}1
  {Ь}{{\selectfont\char220}}1
  {Э}{{\selectfont\char221}}1
  {Ю}{{\selectfont\char222}}1
  {Я}{{\selectfont\char223}}1
  {і}{{\selectfont\char105}}1
  {ї}{{\selectfont\char168}}1
  {є}{{\selectfont\char185}}1
  {ґ}{{\selectfont\char160}}1
  {І}{{\selectfont\char73}}1
  {Ї}{{\selectfont\char136}}1
  {Є}{{\selectfont\char153}}1
  {Ґ}{{\selectfont\char128}}1
  {\{}{{{\color{brackets}\{}}}1 % Цвет скобок {
  {\}}{{{\color{brackets}\}}}}1 % Цвет скобок }
}
 
 % Для настройки заголовка кода
\usepackage{caption}
\DeclareCaptionFont{white}{\color{сaptiontext}}
\DeclareCaptionFormat{listing}{\parbox{\linewidth}{\colorbox{сaptionbk}{\parbox{\linewidth}{#1#2#3}}\vskip-4pt}}
\captionsetup[lstlisting]{format=listing,labelfont=white,textfont=white}
\renewcommand{\lstlistingname}{Код} % Переименование Listings в нужное именование структуры


%------------------------------------------------------------------------------

\author{А.~В.~Никитина}
\title{Сети ЭВМ и телекоммуникации}
\begin{document}
\listoftodos
\maketitle
\chapter{Система дистанционнго тестирования}
\section{Функциональные требования}
\subsection{Задание}
Разработать клиент-серверную систему дистанционного тестирования знаний, состоящую из централизованного сервера тестирования и клиентов тестирования.
\subsection{Основные возможности}
Серверное приложение должно реализовывать следующие функции:
\begin{enumerate}
\item{Прослушивание определенного порта}
\item{Обработка запросов на подключение по этому порту от клиентов}
\item{Поддержка одновременной работы нескольких клиентов через механизм нитей}
\item{Регистрация клиента, выдача клиенту результата его последнего теста, выдача клиенту списка тестов}
\item{Получение от клиента номера теста}
\item{Последовательная выдача клиенту вопросов теста и получение ответов на вопросы}
\item{После прохождения теста – выдача клиенту его результата}
\item{Обработка запроса на отключение клиента}
\item{Принудительное отключение клиента}
\end{enumerate}

Клиентское приложение должно реализовывать следующие функции:
\begin{enumerate}
\item{Установление соединения с сервером}
\item{Посылка регистрационных данных клиента}
\item{Выбор теста}
\item{Последовательная выдача ответов на вопросы сервера}
\item{Индикация результатов теста}
\item{Разрыв соединения}
\item{Обработка ситуации отключения клиента сервером}
\end{enumerate}
\subsection{Настройки приложений}
Разработанное клиентское приложение
должно предоставлять пользователю настройку IP-адреса или доменного
имени удалённого сервера тестов и номера порта, используемого сервером.
Разработанное серверное приложение должно хранить вопросы и правильные ответы нескольких тестов.
\section{Нефункциональные требования}
\subsection{Требования к реализации}
Соединение начинает клиент,отправляя серверу фиксированную строку, говорящую о начале соединения (пусть, например, пока это строка "!"). Далее происходит обмен необходимым набором сообщений: регистрация клиента, выбор теста, прохождение теста.  Когда клиент ответит на все вопросы теста, сервер выдает результат клиенту и символ окончания соединения (например, тот же символ "!"). После получения результата клиент должен разорвать соединения, если это не сделано за фиксированное время(пусть будет 2 минуты), сервер должен принудительно отключить клиента.
\subsection{Требования к надежности}
Длина отправляемого пакета от клиента серверу при регистрации клиента должна проверяться на максимальное значение, так мы защищаем сервер от "падения" при отправке слишком длинного сообщения.\newline
При отправке от клиента серверу ответа на вопрос или номера выбранного текста формируем пакеты длиной=1, так как больше нам и не требуется.
\section{Накладываемые ограничения}

\chapter{Реализация для работы по протоколу TCP}
\section{Прикладной протокол}
\textbf{Алгоритм функционирования сервера}, который занимается обслуживанием удалённых тестируемых:\\
Запуск сервера. Сервер производит анализ зарегистрированных профилей тестируемых. \\
Основная работа сервера. Сервер "прослушивает" поределенный порт на наличие запросов со стороны клиентов. При запросе клиента на получение теста, сервер начинает передавать поочередно вопросы теста и анализировать ответы клиента. После окончания тестирования, сервер сохраняет результат в файл клиента и завершает работу. \\
\textbf{Алгоритм работы клиента}, который хочет произвести удалённое тестирование:\\
После запуска, сервер просит ввести тестируемого его персональный пароль или зарегистрироватся. Если клиент с введённым паролем зарегистрирован, то сервер начинает ему пердавать поочередно вопросы теста.После завершения тестирования, клиент отключается от сервера и завершает работу.
\subsection{Начальная реализация (то, что есть)}
Первоначально клиент отправляет цифру, указывающую на номер выбранного теста, далее сервер начинает  отправлять вопросы теста в следующем виде.
\begin{center}
\textbf{How are you? 1)ok 2)bad 3)nice 4)good}
\end{center}
Клиент должен отправить цифру от 1 до 4, указывающую на выбранный ответ. В ответ сервер отправляет "right" либо "wrong" в зависимости от правильности ответа. Так обрабатываются все вопросы теста.\\
После того, как клиент ответит на все вопросы выбранного теста, сервер выдает клиенту его результат, например такой.\begin{center}
Number of question 15\\
Number of true answer 7
\end{center}
После чего сервер отправляет символ, обозначающий конец соединения '!'. Получив этот символ, клиент обрывает соединение функцией close(s). 
\section{Архитектура приложения}
\textbf{Формат исходных файлов.}\\
Каждый тест хранится в отдельном текстовом файле с именем, соответсвующим номеру тесту(1.txt, 2.txt).
Каждая строка в этих файлах представляет из себя отдельный вопрос теста. \newline
\textbf{Формат строки}\newline 
\begin{center}
$1\mp How are you?\mp ok \mp bad \mp !nice \mp good/$
\end{center}
\textbf{$'\mp'$}-знак-разделитель, разделяет элементы строки\newline
\textbf{'/'}-знак конец строки\newline
\textbf{'!'}-знак, обозначающий правильный ответ, ставится перед верным ответом после символа-разделителя \textbf{$'\mp'$} \newline
Элементы строки в порядке их следования:
\begin{itemize}
\item{номер вопроса}
\item{вопрос}
\item{ответ1}
\item{ответ2}
\item{ответ3} 
\item{ответ4}
\end{itemize}
Таким образом, сервер для каждого теста должен считывать информацию из нужного файла. При считывании строка должна обрабатываться специальным парсером, разбирающим строку соответсвущим образом.\\
Создадим новый модуль writeStruct, занимающийся парсером строки. Модуль определет структуру читаемого вопроса struct Line. Структура состоит из
\begin{itemize}
\item{int number-номер вопроса}
\item{char *question-строка-вопрос}
\item{char **answer-массив строк-ответов}
\item{sizeNumber-количество цифр в номере вопроса}
\item{*sizeAnswer-количество символов в строках-ответах} 
\item{sizeQuest-количество символов в строке-вопросе}
\item{trueAnswer-верный ответ}
\end{itemize}
Также модуль имеет функции для считывании строк и заполнения структр\\
\begin{center}
void writeStruct (struct Line *x, char *str);\\
void writeSize(struct Line *x,char *str);\\
\end{center}
Для отправки вопроса клиенту, следует обратно собрать его в строку для наглядного предоставления информации\\
\begin{center} 
char *writeToClient(struct Line *x);\\
\end{center}
\section{Тестирование}
\subsection{Описание тестового стенда и методики тестирования}
Для тестирования приложений запускается сервер «Удаленного тестирования» и несколько клиентов. В процессе тестирования проверяются основные возможности сервера по параллельному тестированию нескольких пользователей.
\subsection{Тестовый план и результаты тестирования}
По шагам, с перечнем входных данных

\chapter{Реализация для работы по протоколу UDP}
\section{Прикладной протокол}

Например, в табличном виде -- набор и формат команд, размеры полей
(для создания таблиц можно пользоваться Wizard -> Quick tabular)


%\begin{tabular}{|c|c|}
%\hline 
%first & second \\ 
%\hline 
%third & fourth \\ 
%\hline 
%\end{tabular} 


В случае незначительных изменений допустимо перечислить их со ссылкой на раздел \ref{protocol_tcp}, описывающий протокол для взаимодействия по TCP .

\section{Архитектура приложения}
Особенности архитектуры и ограничения (желательно с графической схемой) 

\section{Тестирование}
\subsection{Описание тестового стенда и методики тестирования}
\subsection{Тестовый план и результаты тестирования}
По шагам, с перечнем входных данных,
а также  методика тестирования поведения программы на потерю, дублирование и перемешивание дейтаграмм

\chapter{Выводы}
Анализ выполненных заданий, сравнение удобства/эффективности/количества проблем при программировании TCP/UDP
\section{Реализация для TCP}
\section{Реализация для UDP}

\chapter*{Приложения}
\section*{Описание среды разработки}
Версии ОС, компиляторов, утилит, и проч., которые использовались в процессе разработки
\section*{Листинги}
\subsection*{Основной файл программы main.c}
%\lstinputlisting[]
%{/home/user/workspace/tcp_server/main.c}
\subsection*{Файл сборки Makefile}
%\lstinputlisting[language=make,label={Makefile}]
%{/home/user/workspace/tcp_server/Makefile}
\todo[inline]{Не забыть вставить все исходники}
\end{document}